# 10月15号

## （1）说一下哨兵集群的作用是什么？

哨兵（Sentinel）集群是一种高可用性的解决方案，主要的作用有：

1. 监控：持续检查主服务器和从服务器是否正常运行
2. 通知： 当被监控的 Redis 实例发生故障时，Sentinel 可以通过 API 向其他应用程序或管理员发送通知。
3. 自动故障转移：
   - 当主服务器宕机时，Sentinel 之间会进行协商，投票选出一个 Sentinel 来执行故障转移。
   - 选中的 Sentinel 会在众多的从服务器中，通过一系列策略（如优先级、复制偏移量等）选举出一个新的主服务器（`slaveof no one`）。
   - 让其他从服务器去复制新的主服务器（`slaveof <new-master-ip> <new-master-port>`）。
   - 当故障的主服务器重新上线时，它会被自动配置为新主服务器的从服务器。
4. **配置提供者（Configuration Provider）：** 客户端连接到 Sentinel 实例，获取当前正确的主服务器的地址。即使主服务器发生了切换，客户端也能通过 Sentinel 及时获取到新的主服务器信息。



## （2）说一下什么是主观下线和客观下线

1. 主观下线（Subjectively Down, SDown）：如果某sentinel节点发现某实例未在规定时间响应,则认为该实例主观下线。
2. 客观下线:若超过指定数量(quorum)的sentinel都认为该实例主观下线,则该实例客观下线。quorum值最好超过Sentinel实例数量的一半。



## （3）你在项目中哪里用到了es？用来做什么？如何保证es和数据库的一致性？

全文检索：用来做一个微商城的商品模糊查询 + 筛选查询

多维度过滤/聚合：可以根据医疗设备/耗材的类型，品牌，价格区间，以及发货地（可以排序）等进行筛选

使用query.bool.filter进行多维过滤，terms 聚合：用于分类统计（类型、品牌），range 聚合：用于数值区间统计



1. 同步双写（简单/低并发）
   - 在更新数据库事务成功后，立即同步调用 ES 的更新 API。（用异步MQ更好）

2. RabbitMQ



## （4）说一下es倒排索引的底层原理？

> 非结构化强数据类型

> [!tip] 
>
> -  **正向索引**是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是**根据文档找词条的过程**。 
> -  而**倒排索引**则相反，倒排索引的概念是基于MySQL这样的正向索引而言的。是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是**根据词条找文档的过程**。 
>

倒排索引的建立过程是：

- 将每一个文档的数据利用**分词算法**根据语义拆分，得到一个个词条
- 倒排索引记录每个词条对应的文档id

搜索的过程是：

- 对输入的关键字进行分词，得到一个一个的词条
- 拿词条去倒排索引中查找，找到词对应的文档id
- 将所有匹配的文档id合并为结果集。





## （5）说一下match和term的区别

**`term` 查询是精确匹配查询**，而 **`match` 查询是全文检索查询**。

- `term` 查询不会对查询条件进行分词，直接拿整个字符串去和倒排索引中的词条做完全匹配。一般用于结构化数据查询，比如：ID、城市、品牌、状态、分类字段等。查询适用于 keyword 类型字段，强调**完全一致**。

- `match` 查询会根据字段的 analyzer 对查询字符串进行分词，然后逐个词条去匹配倒排索引。一般用于 text 类型字段的模糊搜索，例如名称、标题、描述、内容等。查询适用于 text 类型字段，强调**相关性匹配（模糊搜索）**。
