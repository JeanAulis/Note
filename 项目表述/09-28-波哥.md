**面试官：**

这个逐字稿还是有点感觉的，这个算是花了时间去整理的一个逐字稿。刚才那些都准备的都不行的，刚才前面那8位同学都很拉胯的，OK，准备好了就开始吧。

**我：**

好的，面试官，我叫老表，来自广西xx，目前是有三年的Java后端开发经验。我上一个项目是一个关于医疗设备的一个平台，主要是做一个设备的一些实时数据，还有一些设备的一些买卖，不能说贩卖吧，就是说售卖。然后，还可以进行一些个人微圈子的一些沟通分享，还有一些个人的中心，一些什么资料的一些查看，还有一些积分，还有一些历史足迹，以及收藏，主要设计技术上有MyBatis，还有Spring Boot，还有Spring Clound Alibaba，以及一个远程调用OpenFegin，微服务组件Nacos、网关Gateway、RabbitMQ。我的自我介绍就到这里。你看一下，有什么想问的吗？

**面试官：**

目前住在哪里。

**我：**

目前呢，住在黄村附近。

**面试官：**

建议换一下，为什么学长笑的，你知道吗？

**我：**
不可以吗。

面试官：黄村不直接摊牌了嘛，我干黑马附近嘛。

**我：**

之前洪哥说是可以的

**面试官：**

在黄村你说远一点，好说远一点。我看到你这个简历滑了，一个删除线，所以特意问你一下。你这个项目，你们公司，你们都是在非洲吗？都是老广，是吧？非洲老广，说一下你这个项目的团队成员吧，

**我：**

我们大概是有10位的左右，我们是4名左右的一个后端，还有两个前端、一名产品经理，还有一个测试，一个运维，还有一个项目经理，大概是这些。

**面试官：**

这样是吧，对你在你们团队大概的定位是什么。

**我：**

我认为是一个中级的后端开发。

**面试官：**

说一下你的工作职责。

**我：**

我在里面主要负责的，在这个项目主要负责的是一个小程序登陆，还有一个设备管理，还有订单后台管理，以及一个微商城，一些相关的一些一些处理。

**面试官：**

你说的是负责的模块，那我想问你的工作职责，可能说你的日常，比如说我负责了这几个模块，对吧？然后你要说一下，我会负责这几个模块的技术方案的设计、评审、代码的开发、测试、部署、以及解决剩下的问题，这样我才能更立体的了解你日常做的什么，明白吧？会更好一点。那说一下你的项目的难点，

**我：**

我项目的难点主要是在于一个登录的一个校验，之前，我们是了解到用户登录的时候需要频繁的一个登录，我们就设计了一个双token的一个校验，减少了用户的一个频繁登录，优化了一下，还有一个设备IoT的大量数据拥塞的时候，我们是怎么接收的。

**面试官：**

就这两个方面模块太少了，那你先说一下登陆校验的双token机制了

**我：**

我们是设计了一个长token，一个短token。在用户登录的时候，我们是把它的信息封装到一个短token里面去，然后把短token返回给前端用来调用，就是用来一个身份的验证。然后长token是用来保证一个短token经常失效的一个问题。长token是一次性使用的短token，在失效之后，我们先去一个Redis里面查看它的长token是否存在。如果存在的话，就直接刷新一个短token，也顺便把它的长token一起刷新了，然后再把短token再一起存入进去Redis来，这样进行一次性使用，避免被盗用的一个风险。

**面试官：**

那你现在的token会存在两次。写要写短token，要写长token，对吧？

**我：**

对。

**面试官：**

怎么保证两次写操作的原子性呢？

**我：**

我们采用一个事务来进行

**面试官：**

具体展开一下。

**我：**

好，我们使用一个 @Transactional，那个事务嘛，就是把一个写操作，两个写操作是放在一起。

**面试官：**

你说通过 @Transactional 能注写，对不对？那我想问一下，@Transactional 能实现原理是什么？

**我：**

是底层是用了 AOP实现原理这一点。

**面试官：**

是没有问题的，是基于AOP，那你要想一想，它基于AOP，它的ACID保证的到底是数据库的ACID，还是Redis的ACID。

**我：**

Redis。

**面试官：**

Redis，什么时候我们讲的ACID？

**我：**

它也是一种数据库。

**面试官：**

Redis的确能做事务，但是我们目前的 @Transactional 的原理实际上是做什么呢？实际上是做数据库层面原子性、一致性、隔离性和持久性，或者换句话说，你目前的 @Transactional 的注写没有办法保证 Redis 本身的原子性。它不是**关系型数据库**，它没有事务的。你像，我们当前在讲MySQL的时候，是不是有存储引擎 MyISAM 和 InnoDB 这些？你发现是不是有的存储引擎，不支持事务的，对，那现在 Redis 就是这样，它不支持你这种 @Transactional 的注写原理实现的这种事务的，所以你这个注写是没有办法保证的。Redis本身多个写操作的原子性的反面方案，本身带来**不合理性**。那可不可以保证呢？可以保证说一下你用什么，可以来这个。

**我：**

AOP。就直接使用AOP拦截

**面试官：**

也不行。了解一下Lua脚本，Lua，它本身是保证 Redis 多个写操作的原子性的一种方案。Lua这个在秒杀场景下用的就比较多了。双token带来的优点就讲到这里，马上就明白了。如果没有，我们说一下 IoT 这个模块吧。

**我：**

IoT 这个模块呢，用户是先登录到我们的首页，首页就展示了一个设备的一个信息。点击一个具体的设备，我们就可以查看它的一个实时的数据，比如说一个项目，一个设备下面的一个参数，就可以查看它的实时数据。然后点击一个具体的一个实时数据的参数，它就是可以查看它的历史数据。历史数据这块，我们做了一个报表处理，就是说展示了它的历史数据，用图表来展示的。

**面试官：**

历史数据目前大概有多少历史数据？

**我：**

大概有一千万左右。

**面试官：**

那你们用什么来存呢？

**我：**

用MySQL来进行存储。

**面试官：**

几张表呢？

**我：**

一张表。一张表存储一个一个设备。

**面试官：**

你知道MySQL，所以我们默认为建议单表存储多少条吗？所以这张表你现在肯定不行了，千万级别。如果你是做报表，你这里面可以用ES，当然你MySQL也可以。那你要做分库分表，知道吧？**五百万你就要分库分表了**。**五百万或者说这个文件大小达到了2GB**，我们就要分了，默认为五百万左右，就差不多是2GB。那现在问题来了，你没有了解过分库分表怎么实现，没有这方面。

**我：**

不是，我是进行的是我们组长来进行实现了。

**面试官：**

洪哥带过来，他应该跟大家说了。应该给大家说分库分表，对吧？他应该拿出这个点，但是我建议呢还是要了解一下。只要分库分表的东西很简单，就是知道与不知道，就是说原理很简单的。技术实现也非常简单，我带的班都讲分库分表，而且做分库分表，就是一个配置文件，就搞定了。用Sharding JDBC，或者ShardingSphere，他们两个是一个东西，不同的版本。然后也可以用Mycat，“我的猫”。Mycat两个都可以实现分库分表呢，分为水平跟垂直两个。你去了解一下吧，你这个里面写海量数据，那我肯定会问你怎么存，有没有做分库分表？你既然写了，你就要去讲这个，要不然你就不写这个模块，好吧？还有没有别的觉得比较难的？

**我：**

就是 IOT 接受大量数据。

**面试官：**

海量数据，那你怎么做削峰填谷呢？

**我：**

我们使用一个线程池来进行异步的一个处理，来加快它的落地。

**面试官：**

但是线程池本质还是用了你自己的内存的呀。你这个时候如果如何避免OOM。

**我：**

我们也使用了一个 RabbitMQ进行一个队列嘛，进行一个削峰。

**面试官：**

你说一下你的线程池和MQ的使用关系什么样子呢？什么时候进入了线程池？什么时候发 MQ 呢？

**我：**

是先进入一个线程池，然后线程池就分发到 RabbitMQ 的一个队列里面进行一个消费。

**面试官：**

这个~~流程~~，这个技术方案的合理性还是可以的。海量数据，这种东西，面试官在你接下来去做线下面试的时候，经常会问：我一下子导入一千万条数据怎么处理？我一下导出两千万条数据怎么处理？我数据表已经有五千万数据，怎么来做？所有的海量，我们的思想就是一个叫分治法，分开的分治。分治法大概就是说，我一次性处理不了这么多，我把一千万份成十份，那每个呢就是一百万。我可以再把一百万再分成十份，每个是十万。分治，分开，而分治的核心就是多线程，那多线程。你发现所有的数据还在内存，所以可以用MQ削峰填谷异步去做。这样子，过去有没有遇到过OOM？

**我：**

没有我们，这方面没有遇到，但是我们遇到的话，我们是也是进行一个分治处理。

**面试官：**

OOM呢如果你真工作三年，很快会遇到的。说一下哪些场景会遇到？

**我：**

比如说大量的请求到我们的一个接口上，还有一些大量数据入库，大量数据分发的时候可以。

**面试官：**

说，你大概这个点抓到了，但是呢，比较泛化，或者说不够具体。大文件导入导出，会导致OOM。一个文件，比如说五百兆，十个用户来，我就干五个G了，我内存能有多少。我还有其他的服务在跑呢，Excel导入导出，这是会导致的，还有MQ的积压也会导致的，然后还有Redis缓存三兄弟，（穿透、雪崩、击穿），都会导致的。然后还有慢SQL，为什么慢SQL也会导致OOM呢？因为刚才我们讲了一点，就是数据库是有连接池的，我会就类似我们的核心线程数一样，我固定的维护了，比如说二十多个连接数，当你第二十一个来，你就连接不上，你怎么办？你在内存上等，等我释放那个连接，什么时候会占有这个连接，就是数据（事务）没提交，我那个连接就一直占用。所以第二十一个过来，我就等，那第二十二个也等，第二十三个也等。假如说我来了很多，那都等等的，这个东西会占用一个线程，它就会占用内存，所以导致我内存原来就要搞一个，搞最终就会OOM。所以这几个场景，你要关注好，就是你工作三年不可能遇不到OOM，你一定会遇到，你一定会遇到。你比较合适的是那些场景都要去研究一下。你最近有在学什么新技术吗？

**我：**

有的，我最近在学一个微服务的那些新的一些技术嘛。

**面试官：**

比如说呢，举个例子。

**我：**

比如说，那个Seata。

**面试官：**

Seata是吧？

**我：**

对。

**面试官：**

那讲讲 Seata 吧。

**我：**

这是我计划之内的事，我还暂时没有实现。

**面试官：**

一般来说，你最近有什么学习新技术呢？把微服务的拿过来，微服务的 Seata Sentinel，然后还有就是ES这三个可以说，或者说后面说什么。说我们后面讲的Spring AI，为什么我面试会问这个呢？你有没有自己学习的能力啊？这样子的，可能会问你的离职原因是什么。

**我：**

在之前的公司呢，就是说有一个一定的那个什么，这不太记得，离职原因不太记得，不能怎么。

**面试官：**

那我肯定不能跟你发offer。离职的原因，期望薪资。你有什么想问我的？这种问题，我们见过太多学生当问的时候呢，说不出来。你说你就是没工作过，你真工作过，你不可能不说出来这些的。 当然，你也不要说，哎呀，你领导太傻逼了，那万一面试你这个领导，他也被人骂过呢。 哎呀，加班太多了，万一他这个也加班很多呢。一般来说，离职原因可以说因为父母的原因。之前呢，比如说，一直在广西上班，薪资比较低，然后呢，父母也在广州这边来打工的，所以我想的是在广州这边来扎根。 广西来广州太多了，这样子呢，你说一下就行了。但是呢，不见你说是女朋友的原因，你因为女朋友来就意味着分手之后，你可能因为女朋友离职，所以不太稳定。你怎么看待加班？

**我：**

我认为加班是合理的，合适的加班能让我们，呃，就是说，能快速地解决问题，也能对一些问题的深究嘛，提供一定的时间来进行处理嘛。

**面试官：**

我觉得这种啊，就是真实的回答一点就好。就是，哎呀，我能接受加班，我也不太相信。说的白了，你回答得不够真诚。你怎么看待加班？面试官，能不加班就不加班。当然，你说现在这个大环境不好，你都免不了加班。你说我上一家也加班，那该加班就加班。但是，尽可能不加班。你说我也不排斥，但这个事呢，尽可能不加就行了。真诚一点，不要所有的都那个。那现在啊，我们的薪资范围是10到15，你报价多少。

**我：**

13k左右。

**面试官：**

我们班啊，在201有一个比较奇怪的现象，10到12，他报12的那个男生不要，报13的那个女生，要13.5，他报13.5要，而且有好几个这样子的。10到15，我建议的，你就报14到15，他百分百会压价的这样子，所以这也是一个报薪技巧。 当然，我们都要找工作，在11月，我们应该在11月中，下旬找工作，就是你们班应该11月中旬吧，或者说初都有可能，因为快过年了，所以你们大概一个月之后就差不多，因为有个国庆假，那你要想倒退一个月之后。 我操，我上班了，我中州都有点忘了的，所以你要现在想想，以终为始，你要开始多背八股文，要各方面表达倒是流畅的。你期望薪资多少？

**我：**

13k。

**面试官：**我靠，都奔着我这个班的均薪来了是吧，想破我的记录是吧，估计你们不行的，给你们一点机会都不行的。 主要是我现在这个班找工作节点，会比202、203要好一点，202是12月，你们什么时候毕业，12月中旬是吧，我那个203，12月底就好像跟你们班差两周，到时候洪哥带202，我带2023嘛，这两个班的均薪，我们就在11到12之间，客观来说找工作快过年了，我们到时候就是先上班，虽然没上班，离过年那两个月的，但是呢，年前零散招招招的话，薪资当然给的太高，岗位一定是有的，薪资肯定没那么高一点。10到15记住你报14就行了，你报14就行了，到时候面两家，我靠，当时听波哥，让我报14，现在一家都过不了，但是我这个班，除了一个同学章毅，其他同学报14都是可以的，你要保持绝对的自信就行了。 打了一个B的分，胜在沟通表达和思维逻辑比较清晰，差在呢，知识面还是太欠缺了，说白了，有好多东西你都不会。但是这个逐字稿准备了很多货，没有发挥出他最大的效果吧。