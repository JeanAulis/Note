# 项目表述

## 1、自我介绍

面试官你好，我叫农锦丰，来自广西崇左，目前有3年的Java后端工作经验，上一家公司是“岫云医芯一云医疗科技有限公司”，主要是做医疗服务。

我使用的技术栈有Spring Boot、Redis、Mybatis、Mybatis-Plus、AOP、Docker、Nginx、微服务架构

> [!NOTE]
>
> ### 你们的团队有多少人？
>
> 我所在的项目组有10个人左右，4~5个后端，2个前端，1个测试，1个运维，1个产品经理，1个技术主管。
>
> ### 你们公司在哪？
>
> 非洲



## 2、项目背景

在后疫情时代，伴随着信息技术的飞速发展，以及公众健康意识高涨，远程医疗、智能硬件和数字疗法成为大健康产业的核心增长点。

在此背景下，我们的项目旨在构建一个符合时代需求的“软硬件一体化”数字健康生态平台。用户可以通过在小程序连接我们的（或者第三方的）智能医疗设备，比如血糖仪、心率监测仪等，为用户提供实时、持久化的健康数据追踪和个性化疗程管理，让用户足不出户就可以对自己的健康有深入的了解。同时，平台整合了在线问诊、健康社区互动和医疗电商服务，满足了用户对专业医疗资源获取、同伴支持交流及便捷购买健康产品的复合型需求。

为支撑该生态的稳定运营，我们打造了强大的BOSS管理后台，实现对设备、疗程、订单、社区及积分体系的精细化、数字化运营，最终目标是打造一个以用户为中心，融合IoT技术、医疗服务和社交电商的闭环健康管理生态系统，积极响应国家“健康中国”战略的数字化浪潮。

## 3、用户，日活，QPS,  TPS

我们项目总用户数约2万，日订单在500左右，日活在3000左右，我们在实际环境中测试的**峰值QPS**在80左右，TPS在高峰期大概在0.8-1.2左右，压测QPS在300左右。（总数据，峰值、平均QPS）

## 4、技术选型

我们的项目前端使用的是Vue，使用Ajax/Axios发送异步请求，还有ElementPlus的组件（Vant组件库也使用过，但是最近对小程序的组件维护比较少），后端使用的是主流的Spring Boot框架，Mybatis，Mysql，Redis，



## 5、项目整体划分

小程序端包含有微商城、~~在线咨询~~、~~社交圈~~、IoT设备管理、数据监控、用户疗程、个人中心等这些模块

Web端：订单管理、文档管理，圈子管理，疗程管理以及基础设计等



### 6、？

> 7~8个模块



### 7、详细设计

技术点、细节、数据库设计、为什么要有、接口文档、详细描述、业务流程图、系统时序图、这个点为什么要用线程池（用那那些）、Redis（哪些数据结构）



> [!caution] 
>
> 把面试官当成，不会用手机的老年人
>
> 2~3min，以服务这个为准
>
> 按流程概括性讲，项目背景（市场，解决社会问题 -> 市场调研）-> 负责功能，流程 （微信小程序、登录完之后 -> 医院服务列表）->  详细设计 -> 
>
> 要完整的说完整个流程，避免太散，说得太乱，不用太强调模块。
>
> 不熟悉的不要写





> [!warning]

> [!tip]

>  [!note]

> [!caution]

> [!important]





> [!note]
>
> ### 用户登录模块
>
> 首先，前端调用wx.login()获取临时登录凭证code，然后传给后端。
> 后端拿到code后，结合配置的appid和appsecret，调用微信的code2Session接口获取用户的openid和session_key（如果用户已授权给同主体其他应用时才返回UnionID）。
> 接着，根据openid查询数据库判断用户是否已存在，如果不存在就创建新用户记录。
>
> 对于需要手机号的场景，我们采用了额外的授权流程：
> 后端先根据getAccessToken接口（需要grant_type、appid、secret）获取access_token，再根据前端传入的code（phoneCode）和access_token（URL参数）向微信接口getPhoneNumber发起请求获取手机号
>
> 最后，将用户信息封装到JWT token中返回给小程序，后续的业务请求都携带这个token。
>
> 
>
> ### Redis和JVM缓存
>
> 医生简介，等等，Redis使用的数据结构，
>
> > [!tip]
> >
> > 用什么技术点，解决什么技术点
>
> 针对首页展示信息、用户疗程列表这些读多写少的场景，我设计了一个二级缓存架构来优化查询性能。
>
> 具体的查询流程是这样的：
> 首先检查JVM本地缓存（我们使用Caffeine实现），如果命中直接返回数据。
> 如果JVM缓存没有，再查询Redis分布式缓存，命中的话返回数据并同时写入JVM缓存。
> 如果Redis也没有，最后查询MySQL数据库，查到数据后同时写入Redis和JVM缓存。
>
> 在缓存管理方面，JVM缓存设置了5分钟过期时间，Redis缓存设置30分钟过期。当后台数据发生更新时，会主动清除对应的Redis缓存，JVM缓存则通过TTL自然过期。
>
> 预约时间段缓存同步机制
> 针对预约时间段查询这种特殊场景，用户需要一次性查询21个时间段的可预约次数，调用频繁但更新较少，我单独设计了一套缓存同步机制。
>
> 我采用了最终一致性的设计思路：在数据库层面设置触发器监听预约表的数据变化，当有预约数据变更时，触发器发送消息到RabbitMQ消息队列，消费者异步处理这些消息更新Redis缓存，同时配置定时任务每5分钟进行全量数据同步作为兜底。
>
> 通过这套机制，响应时间从原来的200ms降低到20ms以内，QPS有了明显提升。虽然牺牲了强一致性，但对预约场景来说几秒钟的延迟是可以接受的。
>
> 
>
> ### 图片上传功能
>
> 我还对接过OSS实现社交圈图片上传功能，前端创建form表单，设置enctype="multipart/form-data"属性，通过input标签选择文件，使用POST方式提交到后端。
>
> 后端使用MultipartFile接收文件数据，我会先做一些校验，比如文件大小限制、格式检查（只允许jpg、png等），然后通过配置好的OSS SDK将文件上传到阿里云对象存储。上传成功后，我会将文件信息（文件名、大小、URL等）保存到数据库，最后返回文件的访问URL给前端。
>
> 这种方案的好处是可以更好地做安全控制和业务处理，比如图片压缩、添加水印、病毒扫描等。我还配置了上传失败的重试机制，以及文件重复性校验（通过MD5避免重复上传相同文件），保证了系统的稳定性和资源的合理利用。
>
> 
>
> ### 阿里云、华为云IoT物联网设备接入
>
> 在我们项目中，我负责对接IoT设备管理模块，主要接入血糖仪、血压计等医疗设备，为用户提供远程健康监测。 技术实现方面，我使用MQTT协议建立设备长连接，处理设备的注册认证和状态监控。定义了标准的物模型，确保不同厂商设备数据的统一格式处理。 当设备上报数据时，通过规则引擎进行数据校验和异常告警，比如血糖值异常会自动通知用户。处理后的数据实时推送到小程序，用户可以立即查看监测结果。 我通过Spring Boot集成阿里云IoT SDK，封装了统一的设备管理服务，成功接入了主流家用医疗设备，提升了陪诊服务的专业性。
>
> 
>
> ### 线程池
>
> ...







> - [ ] 在设计开发过程中，有遇到过什么难点和挑战吗？
>
>
> - [ ] 介绍一个解决过的线上问题，是怎么定位问题？怎么解决？采取什么措施避免以后再发生？
>
> - [x] 核心接口的高峰和平均QPS是多少、用户表和订单表有多少数据等指标参数
>
>
> - [ ] 项目的亮点是什么？
>
>
> - [x] 项目组人员组成
>
>
> - [ ] 整个系统总共多少张表？有哪些表？

