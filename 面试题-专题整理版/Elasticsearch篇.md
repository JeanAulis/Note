[toc]

---

## 1. 你在项目中哪里用到了es？用来做什么？如何保证es和数据库的一致性？

全文检索：用来做一个微商城的商品模糊查询 + 筛选查询

多维度过滤/聚合：可以根据医疗设备/耗材的类型，品牌，价格区间，以及发货地（可以排序）等进行筛选

使用query.bool.filter进行多维过滤，terms 聚合：用于分类统计（类型、品牌），range 聚合：用于数值区间统计

1. 同步双写（简单/低并发）

   - 在更新数据库事务成功后，立即同步调用 ES 的更新 API。（用异步MQ更好）

2. RabbitMQ

   - 在更新数据库事务成功后，讲消息发送到MQ来更新。

   



## 2. 说一下es倒排索引的底层原理？

> 非结构化强数据类型

> [!tip]  
>
> -  **正向索引**是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是**根据文档找词条的过程**。 
> -  而**倒排索引**则相反，倒排索引的概念是基于MySQL这样的正向索引而言的。是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是**根据词条找文档的过程**。 

倒排索引的建立过程是：

- 将每一个文档的数据利用**分词算法**根据语义拆分，得到一个个词条
- 倒排索引记录每个词条对应的文档id

搜索的过程是：

- 对输入的关键字进行分词，得到一个一个的词条
- 拿词条去倒排索引中查找，找到词对应的文档id
- 将所有匹配的文档id合并为结果集。



## 3. 说一下match和term的区别

**`term` 查询是精确匹配查询**，而 **`match` 查询是全文检索查询**。

- `term` 查询不会对查询条件进行分词，直接拿整个字符串去和倒排索引中的词条做完全匹配。一般用于结构化数据查询，比如：ID、城市、品牌、状态、分类字段等。查询适用于 keyword 类型字段，强调**完全一致**。

- `match` 查询会根据字段的 analyzer 对查询字符串进行分词，然后逐个词条去匹配倒排索引。一般用于 text 类型字段的模糊搜索，例如名称、标题、描述、内容等。查询适用于 text 类型字段，强调**相关性匹配（模糊搜索）**。



## 4. es采用什么数据结构

由索引、类型、文档、字段构成。

1. index索引

数据属于哪个索引？不同的数据用不同的索引来区分。

比如 当前有两个索引：

 Account ： 这个索引是用来存放账户数据的

 Book：这个索引是用来存放书本数据的。

2. type类型

指明数据的类型，一个索引里可以有多个类型

比如Account类型有：访客、普通用户、管理员

比如Book类型有：小说、写真、教材

3. document文档

描述的是具体的一条数据记录，一个类型里可以有多个文档。

4. field字段

描述具体记录中的某个字段，一条文档记录中可以有多个字段。