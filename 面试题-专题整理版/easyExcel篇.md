

[toc]

---

## 1. 技术选型使用阿里的easyexcel组件（思考市面组件中为什么选择easyexcel？）

相比Apache POI，EasyExcel内存占用低（SAX模式解析，避免全载入内存），适合大文件；性能高，支持注解式开发，简单易用；社区活跃，阿里维护。
传统 Apache POI 或者 JXL 在解析Excel时会将整个文件内容一次性加载到内存中，容易导致OOM（尤其是上万行以上的数据）。EasyExcel 底层通过 **SAX（事件驱动模型）解析** 实现流式读取和写入，只在内存中保留当前行数据，内存占用极小，性能更高。
 除此之外，EasyExcel 对于复杂头、多Sheet、多样式等都有较好支持，并且有完善的注解映射和批量读写封装，适合Spring Boot体系快速集成。



## 2. 导入和导出都要考虑excel大数据量情况下，产生的oom问题

导入/导出时，使用EasyExcel的流式读写（SAX模式），分批处理数据，避免一次性加载全文件到内存。

1. 导入时使用 EasyExcel 的 `SAX` 模式，边读边处理，不要一次性读入全部数据；
2. 写入数据库时采用**分批批量插入**，比如每 500 条或 1000 条提交一次；
3. 对导出则使用 EasyExcel 的 `writeSheet` 流式写入模式，不将数据全部缓存到List中，而是边查询边写；
4. 如果导出量巨大，可以考虑异步导出，写入临时文件后再提供下载链接。



## 3. 导入时还要考虑如果其中一条数据插入出现问题，全部操作要回滚

使用Spring事务管理（如@Transactional），批量插入时若任一数据失败，整个批次回滚。

导入前先做数据合法性校验（格式、业务逻辑、外键约束等），减少事务内错误；

如果导入量非常大，单事务全包可能性能过低，可以分段事务 + 状态回滚（即记录导入批次，失败则标记失败批次重新导入）。



## 4. 导入和导出都要考虑excel大数据量情况下，如何提升导入导出速度

导入-分批读取+异步处理；导出-分批写入+压缩输出；通用-多线程（若适用）、优化模型类、减少反射。

导入：

- 使用 EasyExcel 的监听器模式，边读边写；
- 批量插入（使用 MyBatis Plus 的 `saveBatch` 或原生 JDBC 批量）；
- 异步处理导入任务，将结果通过消息或表记录通知前端。

导出：

- 分页查询数据，逐页写入Excel，释放内存；
- 使用多线程并行导出多个Sheet或分文件导出；
- 对查询SQL进行索引优化，减少I/O瓶颈。